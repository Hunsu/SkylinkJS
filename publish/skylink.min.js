/*! skylinkjs - v1.0.0 - 2015-07-06 */
var Event={on:function(event,callback){return this.listeners.on[event]=this.listeners.on[event]||[],this.listeners.on[event].push(callback),this},off:function(event,callback){return"undefined"==typeof event&&(this.listeners.on={},this.listeners.once={}),"undefined"==typeof callback?(this.listeners.on[event]=[],this.listeners.once[event]=[]):(this.listeners.on[event]&&this.removeListener(this.listeners.on[event],callback),this.listeners.once[event]&&this.removeListener(this.listeners.once[event],callback)),this},once:function(event,callback){return this.listeners.once[event]=this.listeners.once[event]||[],this.listeners.once[event].push(callback),this},trigger:function(event){var args=Array.prototype.slice.call(arguments,1);if(this.listeners.on[event])for(var i=0;i<this.listeners.on[event].length;i++)this.listeners.on[event][i].apply(this,args);if(this.listeners.once[event])for(var i=0;i<this.listeners.once[event].length;i++)this.listeners.once[event][i].apply(this,args),this.listeners.once[event].splice(i,1),i--;return this},removeListener:function(listeners,listener){for(var i=0;i<listeners.length;i++)if(listeners[i]===listener)return void listeners.splice(i,1)},mixin:function(object){for(var methods=["on","off","once","trigger","removeListener"],i=0;i<methods.length;i++)Event.hasOwnProperty(methods[i])&&("function"==typeof object?object.prototype[methods[i]]=Event[methods[i]]:object[methods[i]]=Event[methods[i]]);return object.listeners={on:{},once:{}},object}},Stream=function(){"use strict";var self=this;self._constraints=null,self.readyState="constructed",self._objectRef=null,self._audioTracks=[],self._videoTracks=[],Event.mixin(self)};Stream.prototype.getAudioTracks=function(){var self=this;return self._audioTracks},Stream.prototype.getVideoTracks=function(){var self=this;return self._videoTracks},Stream.prototype.stop=function(){var self=this;try{self._objectRef.stop()}catch(error){var i,j;for(i=0;i<self._audioTracks.length;i+=1)self._audioTracks[i].stop();for(j=0;j<self._videoTracks.length;j+=1)self._videoTracks[j].stop()}self.readyState="stopped",self.trigger("stopped",{})},Stream.prototype.attachStream=function(dom){var self=this;("safari"===window.webrtcDetectedBrowser||"IE"===window.webrtcDetectedBrowser)&&(dom.hasAttribute("muted")&&dom.removeAttribute("muted"),dom.hasAttribute("autoplay")&&dom.removeAttribute("autoplay")),window.attachMediaStream(dom,self._objectRef)},Stream.prototype._appendListeners=function(mstream){var self=this;self._objectRef=mstream;var i,j,audioTracks=mstream.getAudioTracks(),videoTracks=mstream.getVideoTracks();for(i=0;i<audioTracks.length;i+=1)self._audioTracks[i]=new StreamTrack(audioTracks[i]);for(j=0;j<videoTracks.length;j+=1)self._videoTracks[j]=new StreamTrack(videoTracks[j]);self.readyState="streaming",self.trigger("streaming",{})},Stream.prototype.start=function(constraints,mstream){var self=this;return self._constraints=constraints,"undefined"==typeof self._constraints&&(self._constraints=null),"object"==typeof mstream&&null!==mstream?"function"==typeof mstream.getAudioTracks&&"function"==typeof mstream.getVideoTracks?void self._appendListeners(mstream):Util.throw(new Error("Provided mstream object is not a MediaStream object")):void window.navigator.getUserMedia(self._constraints,function(mstreamrecv){self._appendListeners(mstreamrecv)},function(error){return Util.throw(error)})};var StreamTrack=function(mstrack){"use strict";var self=this;return self.type=mstrack.kind,self.readyState="streaming",self.muted=!mstrack.enabled,self._objectRef=null,Event.mixin(self),"object"!=typeof mstrack||null===mstrack?Util.throw(new Error("Provided track object is not a MediaStreamTrack object")):void self._appendListeners(mstrack)};StreamTrack.prototype._appendListeners=function(mstrack){var self=this;self._objectRef=mstrack,setTimeout(function(){self.trigger("streaming",{})},1e3)},StreamTrack.prototype.mute=function(){var self=this;self._objectRef.enabled=!1,self.muted=!0,self.trigger("mute",{})},StreamTrack.prototype.unmute=function(){var self=this;self._objectRef.enabled=!0,self.muted=!1,self.trigger("unmute",{})},StreamTrack.prototype.stop=function(){var self=this;try{self._objectRef.stop()}catch(error){return Util.throw(new Error("The current browser implementation does not support MediaStreamTrack.stop()"))}self.readyState="stopped",self.trigger("stopped",{})};var Util={};Util.generateUUID=function(){var d=(new Date).getTime(),uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:7&r|8).toString(16)});return uuid},Util.throwError=function(error){if("IE"!==window.webrtcDetectedBrowser)throw error};