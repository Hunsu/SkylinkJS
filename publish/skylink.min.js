/*! skylinkjs - v1.0.0 - 2015-07-03 */
var Event={on:function(event,callback){return this.listeners.on[event]=this.listeners.on[event]||[],this.listeners.on[event].push(callback),this},off:function(event,callback){return"undefined"==typeof event&&(this.listeners.on={},this.listeners.once={}),"undefined"==typeof callback?(this.listeners.on[event]=[],this.listeners.once[event]=[]):(this.listeners.on[event]&&this.removeListener(this.listeners.on[event],callback),this.listeners.once[event]&&this.removeListener(this.listeners.once[event],callback)),this},once:function(event,callback){return this.listeners.once[event]=this.listeners.once[event]||[],this.listeners.once[event].push(callback),this},trigger:function(event){var args=Array.prototype.slice.call(arguments,1);if(this.listeners.on[event])for(var i=0;i<this.listeners.on[event].length;i++)this.listeners.on[event][i].apply(this,args);if(this.listeners.once[event])for(var i=0;i<this.listeners.once[event].length;i++)this.listeners.once[event][i].apply(this,args),this.listeners.once[event].splice(i,1),i--;return this},removeListener:function(listeners,listener){for(var i=0;i<listeners.length;i++)if(listeners[i]===listener)return void listeners.splice(i,1)},mixin:function(object){for(var methods=["on","off","once","trigger","removeListener"],i=0;i<methods.length;i++)Event.hasOwnProperty(methods[i])&&("function"==typeof object?object.prototype[methods[i]]=Event[methods[i]]:object[methods[i]]=Event[methods[i]]);return object.listeners={on:{},once:{}},object}},Stream=function(){"use strict";var self=this;self._constraints={},self._objectRef=null,self._audioTracks=[],self._videoTracks=[]};Stream.prototype.getAudioTracks=function(){var self=this;return self._audioTracks},Stream.prototype.getVideoTracks=function(){var self=this;return self._videoTracks},Stream.prototype.stop=function(){var self=this;try{self._nativeRef.stop()}catch(error){var i,j;for(i=0;i<self._audioTracks.length;i+=1)self._audioTracks[i].stop();for(j=0;j<self._videoTracks.length;j+=1)self._videoTracks[j].stop()}},Stream.prototype.attachStream=function(dom){var self=this;window.attachMediaStream(dom,self._nativeRef)},Stream.prototype._init=function(stream){self._nativeRef=stream;var i,j,aTracks=stream.getAudioTracks(),vTracks=stream.getVideoTracks();for(i=0;i<aTracks.length;i+=1)self._audioTracks[i]=new StreamTrack(aTracks[i],_config.audio.mute);for(j=0;j<vTracks.length;j+=1)self._videoTracks[j]=new StreamTrack(vTracks[j],_config.video.mute)},Stream.prototype.start=function(constraints,stream){var self=this;if("object"==typeof stream&&null!==stream){if(!(stream instanceof MediaStream||stream instanceof LocalMediaStream))throw new Error("Provided stream object is not a MediaStream object");self._init(stream)}else self._constraints=options,window.navigator.getUserMedia(self._constraints,self._init,function(error){return Util.throw(error)})};var StreamTrack=function(track,startAsMute){"use strict";var $$=this,id=null,type=null,_nativeRef=null,mute=function(){_nativeRef.enabled=!0},unmute=function(){_nativeRef.enabled=!1},stop=function(){try{_nativeRef.stop()}catch(error){throw new Error("The current browser implementation does not support MediaStreamTrack.stop()")}},_init=function(track){_nativeRef=track,id=Util.generateUUID(),type=track.kind,startAsMute===!0&&(track.enabled=!1),$$.id=id,$$.type=type,$$.mute=mute,$$.unmute=unmute,$$.stop=stop};if("object"!=typeof track||null===track)throw new Error("Provided track object is not a MediaStreamTrack object");_init(track)},Util={};Util.generateUUID=function(){var d=(new Date).getTime(),uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:7&r|8).toString(16)});return uuid},Util.throwError=function(error){if("IE"!==window.webrtcDetectedBrowser)throw error};