/*! skylinkjs - v0.5.10 - 2015-05-12 */
var IUtil={};IUtil._defaultConfig={audio:{stereo:!1},video:{resolution:{width:640,height:480},frameRate:50},bandwidth:{audio:50,video:256,data:1638400}},IUtil._parseAudioConfig=function(options){options="object"==typeof options?options:!!options;var userMedia=!1,tempOptions={};return options!==!1&&(options="boolean"==typeof options?{}:options,tempOptions.stereo=!!options.stereo,tempOptions.sourceId=options.sourceId||null,tempOptions.mute="boolean"==typeof options.mute?options.mute:!1,options=tempOptions),userMedia="object"==typeof options?!0:options,tempOptions.sourceId&&tempOptions.audio!==!1&&(userMedia={optional:[{sourceId:tempOptions.sourceId}]}),{settings:options,userMedia:userMedia}},IUtil._parseVideoConfig=function(options){options="object"==typeof options?options:!!options;var userMedia=!1,tempOptions={};return options!==!1&&(options="boolean"==typeof options?{resolution:{}}:options,options.resolution=options.resolution||{},tempOptions.resolution=tempOptions.resolution||{},tempOptions.resolution.width=options.resolution.width||IUtil._defaultConfig.video.resolution.width,tempOptions.resolution.height=options.resolution.height||IUtil._defaultConfig.video.resolution.height,tempOptions.frameRate=options.frameRate||IUtil._defaultConfig.video.frameRate,tempOptions.sourceId=options.sourceId||null,tempOptions.mute="boolean"==typeof options.mute?options.mute:!1,options=tempOptions,userMedia={mandatory:{maxWidth:tempOptions.resolution.width,maxHeight:tempOptions.resolution.height,maxFrameRate:tempOptions.frameRate},optional:[]},tempOptions.sourceId&&(userMedia.optional[0]={sourceId:tempOptions.sourceId}),"plugin"===window.webrtcDetectedType&&delete userMedia.mandatory.maxFrameRate),{settings:options,userMedia:userMedia}};var Stream=function(stream,options){"use strict";var $$=this,id=null,_constraints={},_config={},_nativeRef=null,_audioTracks=[],_videoTracks=[],_attachMediaStream=window.attachMediaStream,getAudioTracks=function(){return _audioTracks},getVideoTracks=function(){return _videoTracks},stop=function(){try{_nativeRef.stop()}catch(error){var i,j;for(i=0;i<_audioTracks.length;i+=1)_audioTracks[i].stop();for(j=0;j<_videoTracks.length;j+=1)_videoTracks[j].stop()}},attach=function(dom){_attachMediaStream(dom,_nativeRef)},_init=function(stream){_nativeRef=stream,id=Util.generateUUID();var i,j,aTracks=stream.getAudioTracks(),vTracks=stream.getVideoTracks();for(i=0;i<aTracks.length;i+=1)_audioTracks[i]=new StreamTrack(aTracks[i],_config.audio.mute);for(j=0;j<vTracks.length;j+=1)_videoTracks[j]=new StreamTrack(vTracks[j],_config.video.mute);$$.id=id,$$.getAudioTracks=getAudioTracks,$$.getVideoTracks=getVideoTracks,$$.stop=stop,$$.attach=attach};if("object"==typeof stream&&null!==stream){if(!(stream instanceof MediaStream||stream instanceof LocalMediaStream))throw new Error("Provided stream object is not a MediaStream object");_init(stream)}else{options=options||{};var audioConfig=IUtil._parseAudioConfig(options.audio||{}),videoConfig=IUtil._parseVideoConfig(options.video||{});_config={audio:audioConfig.settings,video:videoConfig.settings},_constraints={audio:audioConfig.userMedia,video:videoConfig.userMedia},window.navigator.getUserMedia(_constraints,_init,function(error){throw error})}},StreamTrack=function(track,startAsMute){"use strict";var $$=this,id=null,type=null,_nativeRef=null,mute=function(){_nativeRef.enabled=!0},unmute=function(){_nativeRef.enabled=!1},stop=function(){try{_nativeRef.stop()}catch(error){throw new Error("The current browser implementation does not support MediaStreamTrack.stop()")}},_init=function(track){_nativeRef=track,id=Util.generateUUID(),type=track.kind,startAsMute===!0&&(track.enabled=!1),$$.id=id,$$.type=type,$$.mute=mute,$$.unmute=unmute,$$.stop=stop};if("object"!=typeof track||null===track)throw new Error("Provided track object is not a MediaStreamTrack object");_init(track)},Util={};Util.generateUUID=function(){var d=(new Date).getTime(),uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:7&r|8).toString(16)});return uuid};