<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="application-name" content="source/User.js - skylinkjs">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Skylink Javascript API documentation</title>
    <!-- font and icon -->
    <link rel="shortcut icon" type="image/ico" href="../assets/favicon.ico">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700|Source+Sans+Pro" type="text/css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700|Source+Code+Pro" type="text/css">
    <!-- styling -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <!-- scripts -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script src="../assets/js/script.js"></script>
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>

<body>

<div id="wrapper">
  <!-- Sidebar -->
<a href="#menu-toggle" id="menu-toggle">
  <!-- Menu icon by Icons8 -->
  <img src="../assets/img/icons/menu.png">
  </span>
</a>
<div id="sidebar-wrapper">
  <ul class="sidebar-nav">
    <li class="sidebar-brand">
      <a href="../" data="">
        <img src="../assets/img/logo.svg"><span>JS</span>
        <small>Version: 0.5.7</small>
      </a>
    </li>
    <li class="header first-item">Information</li>
    <li><a href="../" data="">Introduction</a></li>
    <li><a href="./testing.html">Running Tests</a></li>
    <li class="header">Classes</li>
    
      <li><a href="../classes/DataChannel.html"> DataChannel </a></li>
    
      <li><a href="../classes/Debugger.html"> Debugger </a></li>
    
      <li><a href="../classes/Messaging.html"> Messaging </a></li>
    
      <li><a href="../classes/Peer.html"> Peer </a></li>
    
      <li><a href="../classes/Request.html"> Request </a></li>
    
      <li><a href="../classes/Room.html"> Room </a></li>
    
      <li><a href="../classes/Self.html"> Self </a></li>
    
      <li><a href="../classes/Skylink.html"> Skylink </a></li>
    
      <li><a href="../classes/Socket.html"> Socket </a></li>
    
      <li><a href="../classes/Stream.html"> Stream </a></li>
    
      <li><a href="../classes/User.html"> User </a></li>
    
  </ul>
</div>
<!-- /#sidebar-wrapper -->

<!--<form id="api-tabview" class="navbar-form navbar-right" role="form">
  <div id="api-tabview-filter" class="form-group">
    <input type="search" id="api-filter" placeholder="Type to filter APIs">
  </div>
</form>-->

  <!-- Page Content -->
  <div id="main-wrapper" class="container">
    
    <h1 class="file-heading">File: source/User.js</h1>
<p>You may view this code on github <a href="https://github.com/Temasys/SkylinkJS/blob/master/source/User.js">master branch</a> or on <a href="https://github.com/Temasys/SkylinkJS/blob/development/source/User.js">the current development branch</a>.</p>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Handles the user that joins the room.
 * @class User
 * @constructor
 * @param {JSON} config The user configuration.
 * @param {String} config.id The user id.
 * @param {JSON} config.agent The user browser agent information.
 * @param {String} config.agent.name The user browser agent name.
 * @param {Integer} config.agent.version The user browser version.
 * @param {String} config.agent.webRTCType The user browser WebRTC implementation type.
 * @param {JSON|String} config.data The user custom data.
 * @param {JSON} config.stream The streamming configuration for the &quot;main&quot; shared peer connection.
 * @param {JSON|Boolean} [config.stream.audio=false] The audio stream configuration.
 *    If parsed as a boolean, other configuration settings under the audio
 *    configuration would be set as the default setting in the connection.
 * @param {Boolean} [config.stream.audio.stereo=false] The flag that indiciates
 *    if stereo is enabled for this connection.
 * @param {String} [config.stream.audio.sourceId] The source id of the audio MediaStreamTrack
   *    used for this connection.
 * @param {String|Boolean} [config.stream.video=false] The video stream configuration.
 *    If parsed as a boolean, other configuration settings under the video
 *    configuration would be set as the default setting in the connection.
 * @param {JSON} [config.stream.video.resolution] The video streaming resolution.
 * @param {Integer} config.stream.video.resolution.width The video resolution width.
 * @param {Integer} config.stream.video.resolution.height The video resolution height.
 * @param {Integer} config.stream.video.frameRate The video stream framerate.
 * @param {String} [config.stream.video.sourceId] The source id of the video MediaStreamTrack
 *    used for this connection.
 * @param {JSON} config.stream.status The stream MediaStreamTrack status.
 * @param {Boolean} [config.stream.status.audioMuted=false] The flag that indicates if audio is muted.
 *    If audio is set to false, this would be set as true.
 * @param {Boolean} [config.stream.status.videoMuted=false] The flag that indicates if video is muted.
 *    If video is set to false, this would be set as true.
 * @param {JSON} config.bandwidth The bandwidth configuration for the peer connections.
 *    This does fixes the bandwidth but doesn&#x27;t prevent alterations done by browser for smoother streaming.
 * @param {Integer} [config.bandwidth.audio] The bandwidth configuration for the audio stream.
 * @param {Boolean} [config.bandwidth.video] The bandwidth configuration for the video stream.
 * @param {Boolean} [config.bandwidth.data] The bandwidth configuration for the data stream.
 * @param {Stream} streamObject The stream object passed for the &quot;main&quot; peer connection.
 * @param {String} SDPType The session description type that the peer connection would send.
 * @param {Function} listener The listener function.
 * @for Skylink
 * @since 0.6.0
 */
function User (config, listener) {
  &#x27;use strict&#x27;;

  // Prevent undefined listener error
  listener = listener || function (event, data) {};

  // Reference of instance
  var com = this;

  /**
   * The user id.
   * @attribute id
   * @type String
   * @readOnly
   * @for User
   * @since 0.6.0
   */
  com.id = config.id;
  
  /**
   * The user type.
   * @attribute type
   * @type String
   * @readOnly
   * @for User
   * @since 0.6.0
   */
  com.type = &#x27;user&#x27;;

  /**
   * Stores the user data.
   * @attribute data
   * @type JSON
   * @private
   * @for User
   * @since 0.6.0
   */
  com.data = config.data || {};

  /**
   * Stores the browser agent information.
   * @attribute agent
   * @param {String} name The browser agent name.
   * @param {Integer} version The browser agent version.
   * @param {String} webRTCType The browser agent WebRTC type of implementation.
   * @type JSON
   * @private
   * @for User
   * @since 0.6.0
   */
  com.agent = config.agent || {};
  
  /**
   * Stores the user&#x27;s bandwidth configuration.
   * @attribute bandwidth
   * @param {Integer} audio The bandwidth audio configuration.
   * @param {Integer} data The bandwidth data configuration.
   * @param {Integer} video The bandwidth video configuration.
   * @type JSON
   * @private
   * @for User
   * @since 0.6.0
   */
  com.bandwidth = config.bandwidth || {};
  
  /**
   * Stores the list of peer connections to user.
   * @attribute peers
   * @type JSON
   * @private
   * @for User
   * @since 0.6.0
   */
  com.peers = {};
  
  
  /**
   * Function to subscribe to when the user object is ready to use.
   * @method onstart
   * @eventhandler true
   * @for User
   * @since 0.6.0
   */
  com.onstart = function () {};

  /**
   * Function to subscribe to when user&#x27;s custom data is updated.
   * @method onupdate
   * @eventhandler true
   * @for User
   * @since 0.6.0
   */
  com.onupdate = function () {};
  
  /**
   * Function to subscribe to when user has an established &quot;main&quot; peer connection.
   * @method onconnect
   * @eventhandler true
   * @for User
   * @since 0.6.0
   */
  com.onconnect = function () {};
  
  /**
   * Function to subscribe to when user is disconnected from the room.
   * @method ondisconnect
   * @eventhandler true
   * @for User
   * @since 0.6.0
   */
  com.ondisconnect = function () {};
  
  /**
   * Function to subscribe to when a new peer connection is established to user.
   * @method onaddconnection
   * @eventhandler true
   * @for User
   * @since 0.6.0
   */
  com.onaddconnection = function () {};
  
  /**
   * Function to subscribe to when a peer connection to user has added.
   * @method onremoveconnection
   * @eventhandler true
   * @for User
   * @since 0.6.0
   */
  com.onremoveconnection = function () {};
  
  /**
   * Function to subscribe to when a new data transfer request is initialized from user.
   * @method ondatarequest
   * @eventhandler true
   * @for User
   * @since 0.6.0
   */
  com.ondatarequest = function () {};

  /**
   * Function to subscribe to when a new data is received after transfer is completed from user.
   * @method ondata
   * @eventhandler true
   * @for User
   * @since 0.6.0
   */
  com.ondata = function () {};
  
  /**
   * Function to subscribe to when a new message is received from user.
   * @method onmessage
   * @eventhandler true
   * @for User
   * @since 0.6.0
   */
  com.onmessage = function () {};


  /**
   * The handler that manages all triggers or relaying events.
   * @method handler
   * @param {String} event The event name.
   * @param {JSON} data The response data.
   * @private
   * @for User
   * @since 0.6.0
   */
  com.handler = function (event, data) {
    UserHandler(com, event, data, listener);
  };

  /**
   * Starts a new peer connection to user.
   * @method addConnection
   * @param {JSON} data The shared peer connection streaming configuration.
   * @param {JSON} data.prid The shared peer connection id.
   * @param {Array} data.iceServers The ICE servers the connection should use.
   * @param {JSON} data.stream The streamming configuration for the &quot;main&quot; shared peer connection.
   * @param {JSON|Boolean} [data.stream.stream.audio=false] The audio stream configuration.
   *    If parsed as a boolean, other configuration settings under the audio
   *    configuration would be set as the default setting in the connection.
   * @param {Boolean} [data.stream.stream.audio.stereo=false] The flag that indiciates
   *    if stereo is enabled for this connection.
   * @param {String} [data.stream.stream.audio.sourceId] The source id of the audio MediaStreamTrack
     *    used for this connection.
   * @param {String|Boolean} [data.stream.stream.video=false] The video stream configuration.
   *    If parsed as a boolean, other configuration settings under the video
   *    configuration would be set as the default setting in the connection.
   * @param {JSON} [data.stream.stream.video.resolution] The video streaming resolution.
   * @param {Integer} data.stream.stream.video.resolution.width The video resolution width.
   * @param {Integer} data.stream.stream.video.resolution.height The video resolution height.
   * @param {Integer} data.stream.stream.video.frameRate The video stream framerate.
   * @param {String} [data.stream.stream.video.sourceId] The source id of the video MediaStreamTrack
   *    used for this connection.
   * @param {JSON} data.stream.stream.status The stream MediaStreamTrack status.
   * @param {Boolean} [data.stream.stream.status.audioMuted=false] The flag that indicates if audio is muted.
   *    If audio is set to false, this would be set as true.
   * @param {Boolean} [data.stream.stream.status.videoMuted=false] The flag that indicates if video is muted.
   *    If video is set to false, this would be set as true.
   * @param {JSON} data.bandwidth The bandwidth configuration the peer connections.
   *    This does fixes the bandwidth but doesn&#x27;t prevent alterations done by browser for smoother streaming.
   * @param {Integer} [data.bandwidth.audio] The bandwidth configuration for the audio stream.
   * @param {Boolean} [data.bandwidth.video] The bandwidth configuration for the video stream.
   * @param {Boolean} [data.bandwidth.data] The bandwidth configuration for the data stream.
   * @param {String} data.SDPType The session description type that the peer connection would send.
   * @param {Stream} [stream] The stream object.
   * @private
   * @for User
   * @since 0.6.0
   */
  com.addConnection = function (data, stream) {
    var peerConfig = {
      id: data.prid,
      constraints: data.iceServers,
      bandwidth: data.bandwidth,
      streamingConfig: data.settings
    };
    
    // Add the main streaming config
    com.streamingConfigs[data.stream.prid] = data.settings;
    
    var peer = new Peer(peerConfig, com.handler);
    
    peer.connect(stream);
    
    peer.SDPType = data.SDPType;
    
    com.peers[peer.id] = peer;
    
    com.handler(&#x27;user:addconnection&#x27;, {
      peerId: data.prid,
      config: peerConfig
    });
  };
 
  /**
   * Stops a peer connection to user.
   * @method removeConnection
   * @param {String} peerId The shared peer connection id.
   * @private
   * @for User
   * @since 0.6.0
   */
  com.removeConnection = function (peerId) {
    var peer = com.peers[peerId];
    
    if (!fn.isEmpty(peer)) {
      peer.disconnect();
    }
    
    com.handler(&#x27;user:removeconnection&#x27;, {
      peerId: peerId
    });
  };

  /**
   * Disconnects this user connection.
   * @method disconnect
   * @for User
   * @since 0.6.0
   */
  com.disconnect = function () {
    fn.forEach(com.peers, function (peer, id) {
      peer.disconnect();
    });
  };
 
  /**
   * Gets this user information.
   * @method getInfo
   * @returns {JSON} The user streaming configuration and custom data.
   * - &lt;code&gt;userData&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; String | JSON&lt;/var&gt;&lt;br&gt;
   *   The custom data.
   * - &lt;code&gt;agent&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; JSON&lt;/var&gt;&lt;br&gt;
   *   The user&#x27;s browser agent information.
   * - &lt;code&gt;agent.name&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; String&lt;/var&gt;&lt;br&gt;
   *   The user&#x27;s browser agent name.
   * - &lt;code&gt;agent.version&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; Integer&lt;/var&gt;&lt;br&gt;
   *   The user&#x27;s browser agent version.
   * - &lt;code&gt;agent.webRTCType&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; String&lt;/var&gt;&lt;br&gt;
   *   The user&#x27;s browser webrtc implementation type.
   * - &lt;code&gt;settings&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; JSON&lt;/var&gt;&lt;br&gt;
   *   The list of peer connections streaming.
   * - &lt;code&gt;settings.[peerId]&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; JSON&lt;/var&gt;&lt;br&gt;
   *   The peer connection streaming information.
   * - &lt;code&gt;settings.[peerId].audio&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; JSON|Boolean&lt;/var&gt;&lt;br&gt;
   *   The audio streaming information. If there is no stream connection with the peer,
   *   it&#x27;s &lt;code&gt;false&lt;/code&gt;.
   * - &lt;code&gt;settings.[peerId].audio.stereo&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; Boolean&lt;/var&gt;&lt;br&gt;
   *   The flag that indicates if stereo is enabled for this connection. By default,
   *   it&#x27;s &lt;code&gt;false&lt;/code&gt;.
   * - &lt;code&gt;settings.[peerId].audio.sourceId&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; String&lt;/var&gt;&lt;br&gt;
   *   The audio MediaStreamTrack source used for this connection.
   * - &lt;code&gt;settings.[peerId].video&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; JSON|Boolean&lt;/var&gt;&lt;br&gt;
   *   The video streaming information. If there is no stream connection with the peer,
   *   it&#x27;s &lt;code&gt;false&lt;/code&gt;.
   * - &lt;code&gt;settings.[peerId].video.resolution&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; JSON&lt;/var&gt;&lt;br&gt;
   *   The video stream resolution. 
   * - &lt;code&gt;settings.[peerId].video.resolution.width&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; Integer&lt;/var&gt;&lt;br&gt;
   *   The video stream resolution height.
   * - &lt;code&gt;settings.[peerId].video.resolution.height&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; Integer&lt;/var&gt;&lt;br&gt;
   *   The video stream resolution width.
   * - &lt;code&gt;settings.[peerId].video.frameRate&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; Integer&lt;/var&gt;&lt;br&gt;
   *   The video stream resolution framerate.
   * - &lt;code&gt;settings.[peerId].video.sourceId&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; String&lt;/var&gt;&lt;br&gt;
   *   The video MediaStreamTrack source used for this connection.
   * - &lt;code&gt;settings.[peerId].status&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; JSON&lt;/var&gt;&lt;br&gt;
   *   The MediaStreamTracks enabled status (muted/unmuted).
   * - &lt;code&gt;settings.[peerId].status.audioMuted&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; Boolean&lt;/var&gt;&lt;br&gt;
   *   The audio MediaStreamTrack enabled status (muted/unmuted).
   * - &lt;code&gt;settings.[peerId].status.audioMuted&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; Boolean&lt;/var&gt;&lt;br&gt;
   *   The video MediaStreamTrack enabled status (muted/unmuted).
   * - &lt;code&gt;bandwidth&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; JSON&lt;/var&gt;&lt;br&gt;
   *   The bandwidth configuration for the peer connections.
   *   This does fixes the bandwidth but doesn&#x27;t prevent alterations done by browser for smoother streaming.
   * - &lt;code&gt;bandwidth.data&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; Integer&lt;/var&gt;&lt;br&gt;
   *   The bandwidth configuration for data stream.
   * - &lt;code&gt;bandwidth.video&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; Integer&lt;/var&gt;&lt;br&gt;
   *   The bandwidth configuration for video stream.
   * - &lt;code&gt;bandwidth.audio&lt;/code&gt; &lt;var&gt;: &lt;b&gt;type&lt;/b&gt; Integer&lt;/var&gt;&lt;br&gt;
   *   The bandwidth configuration for audio stream.
   * @for User
   * @since 0.6.0
   */
  com.getInfo = function () {
    var data = {};
    
    data.userData = com.data;
    
    data.agent = com.agent;
    
    data.settings = {};
    
    var i;
    
    for (i = 0; i &lt; com.peers.length; i += 1) {
      var peer = com.peers[i];
  
      var settings = (fn.isSafe() {
        return peer.stream.config;
      })() || {
        audio: false,
        video: false,
        status: {
          audioMuted: true,
          videoMuted: true
        }
      };
      
      settings.bandwidth = peer.bandwidth || {};
      
      data.settings[peer.id] = settings;
    }

    return data;
  };

  fn.runSync(function () {
    com.handler(&#x27;user:start&#x27;, config);
  });
}

    </pre>
</div>

  </div>
  <!-- /#page-content-wrapper -->

  <footer>
    <a href="http://icons8.com">Icon pack by Icons8</a>
  </footer>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
