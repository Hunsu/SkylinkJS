<html>
<head>
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    h3 {
      margin: 0;
    }
    .input-group-addon {
      background: #fff;
      border: 0;
    }
    .col-md-8 {
      padding-left: 0;
    }
    .col-md-4 {
      padding-right: 0;
    }
    video {
      background: #000;
    }
    .btn-group {
      margin-top: 15px;
    }
    #output {
      margin-top: 55px;
      border: solid 1px #ccc;
      word-break: break-all;
      padding: 25px 15px;
    }
  </style>
</head>
<body class="container">
  <h1>Stream Demo</h1>
  <p>Classes: <code>Stream</code>, <code>StreamParser</code> and <code>StreamTrackList</code></p>

  <div class="col-md-8">
    <div class="panel panel-default">
      <div class="panel-body">
        <h4>Example 1:</h4>
        <p>Stream invokes a getUserMedia stream with an option</p>
        <pre>
          // Retrieve list of Streams from StreamTrackList
          Skylink.StreamTrackList.onReady = function () {
            var list = Skylink.StreamTrackList;
            var audioTracks = list.audio;
            var videoTracks = list.video;

            // Get Stream by invoking
            new Skylink.Stream(null, { 
              audio: true, 
              video: true 
            }, function (event, data) {
              console.log(event, data);
            });
          });
        </pre>
        
        <small>Firefox does not support MediaStreamTrack.getSources. You might select a stream manually
         when getUserMedia is invoked.</small>
        <div class="input-group">
          <span class="input-group-addon">Audio Track</span>
          <select id="audioTrackList" class="form-control"></select>
        </div>
        <div class="input-group">
          <span class="input-group-addon">Video Track</span>
          <select id="videoTrackList" class="form-control"></select>
        </div>
        
        <button onclick="getStream()">Get Stream</button>
        
        

        <h4>Example 2:</h4>
        <p>Passes a MediaStream object to the Stream class and attaches event</p>
        <pre>
          getUserMedia({ audio: true, video: true }, function (stream) {
            new Skylink.Stream(stream, {}, listener);
          }, function (error) {
            console.error('exception occurred:', error);
          });
        </pre>
        
        <button onclick="bindStream()">Start</button>
        
      </div>
    </div>
  </div>
  
  <div class="col-md-4">
    <video id="stream" autoplay="autoplay"></video>
    <div class="btn-group">
      <button class="btn btn-default btn-sm" onclick="stopStream()">Stop Stream</button>
      <button class="btn btn-default btn-sm" onclick="stopVideoTrack()">Stop Track-Video</button>
      <button class="btn btn-default btn-sm" onclick="stopAudioTrack()">Stop Track-Audio</button>
    </div>
    
    <div id="output" class="panel"></div>
  </div>
  
  <script src="../node_modules/socket.io-client/socket.io.js"></script>
  <script src="../node_modules/adapterjs/publish/adapter.debug.js"></script>
  <script src="../source/Globals.js"></script>
  <script src="../source/StreamTrackList.js"></script>
  <script src="../source/StreamParser.js"></script>
  <script src="../source/Stream.js"></script>
  
  <script>
    var stream;
    var audioTrackList = document.getElementById('audioTrackList');
    var videoTrackList = document.getElementById('videoTrackList');

    StreamTrackList.onReady = function () {
      // Add to list
      addToOption( audioTrackList, StreamTrackList.audio );
      addToOption( videoTrackList, StreamTrackList.video );
    };
    
    function addToOption(element, list) {
      for (var i = 0; i < list.length; i++) {
        element.innerHTML += '<option value="' + list[i].id + '">' +
          list[i].label + '</option>';
      }
    }

    function getStream () {
      stopStream();

      var options = { audio: true, video: true };
      if (audioTrackList.value) {
        options.audio = { sourceId: audioTrackList.value };
      }
      if (videoTrackList.value) {
        options.video = { sourceId: videoTrackList.value };
      }
      
      stream = new Stream(null, options, handler);
    }
    
    function bindStream () {
      stopStream();

      getUserMedia({ audio: true, video: true }, function (data) {
        stream = new Stream(data, {}, handler);
      }, function (error) {
        console.error('exception occurred:', error);
      });
    }
    
    function handler (event, data) {
      document.getElementById('output').innerHTML += '<p><b>' + event +
        '</b> ' + JSON.stringify(data) + '</p>';
      
      if (event === 'stream:start') {
        stream.attachElement( document.getElementById('stream') );
      }
    }
    
    function stopStream () {
      if (stream) {
        stream.stop();
      }
    }
    
    function stopAudioTrack () {
      stream.stopAudio();
    }
    
    function stopVideoTrack () {
      stream.stopVideo();
    }
    
  </script>
</body>

</html>