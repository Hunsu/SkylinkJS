<html>
<head>
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    h3 {
      margin: 0;
    }
    .input-group-addon {
      background: #fff;
      border: 0;
    }
    .col-md-8 {
      padding-left: 0;
    }
    .col-md-4 {
      padding-right: 0;
    }
    video {
      background: #000;
      width: 49%;
      display: inline-block;
      vertical-align: top;
    }
    .btn-group {
      margin-top: 15px;
    }
    #output {
      margin-top: 55px;
      border: solid 1px #ccc;
      word-break: break-all;
      padding: 25px 15px;
    }
  </style>
</head>
<body class="container">
  <h1>Connection Demo</h1>
  <p>Classes: <code>Globals</code>, <code>DataChannel</code>, <code>DataTransfer</code>, <code>ICE</code>, <code>SDP</code>, <code>StreamParser</code> and <code>Connection</code></p>

  <div class="col-md-8">
    <div class="panel panel-default">
      <div class="panel-body">
        <h4>Example 1:</h4>
        <p>Start a connection with Peer 1 and getting User Media</p>
        <pre>
          var peer = null;
          var stream = new Stream(null, { audio: true }, function(event, data) {
             console.log(event, data);

             peer = new Connection(stream, { id: Date.UTC() }, function (event, data) {
               console.log(event, data);
             });
          });
        </pre>
        
        <p>Peer 1</p>
        <video id="p1local" autoplay></video>
        <video id="p1remote" autoplay></video>
        
        <button onclick="p1getMedia()">Start</button>
        <button onclick="p1createOffer()">Create Peer1's offer</button>
        <button onclick="p1setAnswer()">Set Peer1's answer</button>
        
        <p>Peer 2</p>
        
        <video id="p2local" autoplay></video>
        <video id="p2remote" autoplay></video>
        
        <button onclick="p2getMedia()">Start</button>
        <button onclick="p2setOffer()">Set Peer1's offer</button>
        <button onclick="p2createAnswer()">Create Peer2's answer</button>
        
        <h4>Example 2:</h4>
        <p>Start a connection without receiving audio and video</p>
        
        <pre>
          var peer = new Connection(stream, { 
            id: Date.UTC(),
            sdpConstraints: {
              'mandatory': {
                'OfferToReceiveAudio': false,
                'OfferToReceiveVideo': false,
              }
            }
          }, function (event, data) {
            console.log(event, data);
          });
        </pre>
        
        <h4>Example 3:</h4>
        <p>Start a connection without stream</p>
        
        <pre>
          var peer = new Connection(null, { id: Date.UTC() }, function(event, data) {
             console.log(event, data);

             peer = new Connection(stream, { id: Date.UTC() }, function (event, data) {
               console.log(event, data);
             });
          });
        </pre>
        
      </div>
    </div>
  </div>
  
  <div class="col-md-4">
    <div class="btn-group">
      <button class="btn btn-default btn-sm" onclick="clearL()">Clear Logs</button>
    </div>
    
    <div id="output" class="panel"></div>
  </div>
  
  <script src="../source/Globals.js"></script>
  <script src="../source/StreamParser.js"></script>
  <script src="../node_modules/adapterjs/publish/adapter.debug.js"></script>
  <script src="../source/ICE.js"></script>
  <script src="../source/SDP.js"></script>
  <script src="../source/Connection.js"></script>
  <script src="../source/Stream.js"></script>
  
  <script>
    var peer1 = null;
    var peer2 = null;
    
    var stream1 = null;
    var stream2 = null;
    
    var rstream1 = null;
    var rstream2 = null;
    
    var offer = null;
    var answer = null;


    function handler (event, data) {
      console.log(event, data);
      
      if (event === 'connection:start') {
        peer1.createOffer();
      }

      if (event === 'connection:offer:success') {
        offer = data.event;
        
        peer1.setLocalDescription(offer);
      }
      
      if (event === 'connection:answer:success') {
        answer = data.event;
        
        peer2.setLocalDescription(answer);
      }
      
      if (event === 'connection:remotestream') {
        if (data.id === 'test1') {
          rstream1 = new Stream(data.event, {}, function (event, data) {
            handler(event,data);

            if (event === 'stream:start') {
              rstream1.attachElement(document.getElementById('p1remote'));
            }
          });
        } else {
          rstream2 = new Stream(data.event, {}, function (event, data) {
            handler(event,data);

            if (event === 'stream:start') {
              rstream2.attachElement(document.getElementById('p2remote'));
            }
          });
        }
      }
    }
    
    function clearL() {
      output.innerHTML = '';
    }
    
    trace = function (log) {
      console.log(log);
    };
  
    function p1getMedia () {
      stream1 = new Stream(null, { audio: true, video: true }, function (event, data) {
        stream1.attachElement(document.getElementById('p1local'));
        peer1 = new Connection(stream1, { id: 'test1', dataChannel: true }, handler);
      });
    }
                            
    function p1createOffer () {
      peer1.createOffer();
    }
    
    function p1setAnswer () {
      peer1.setRemoteDescription(answer);
    }
      
    function p2getMedia () {
      stream2 = new Stream(null, { audio: true }, function (event, data) {
        stream2.attachElement(document.getElementById('p2local'));
        peer2 = new Connection(stream2, { id: 'test2', dataChannel: true }, handler);
      });
    }
                            
    function p2setOffer () {
      peer2.setRemoteDescription(offer);
    }
      
    function p2createAnswer () {
      peer2.createAnswer();
    }
  </script>
</body>

</html>